{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)c6842e4b-ce22-4957-a5c5-84cdfb06c249","ParentGuid":"(Guid)552aeba8-69d4-4f40-9593-59848768ad16","Name":"(string)M_JsonEncodeString","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)24568a24-c491-472c-a21f-ee5d33859fab","@Value":{"@Type":"24568a24","@Value":{"MemoryReserveForOnlineChange":"(int)0","ExcludeFromBuild":"(bool)False","External":"(bool)False","EnableSystemCall":"(bool)False","CompilerDefines":"(string)","LinkAlways":"(bool)False","Undefines":{"@Type":"[string]","@Value":[]}}}}]},"TypeGuid":"(Guid)f8a58466-d7f6-439f-bbb8-d4600e41d099","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"24568a24":"{24568a24-c491-472c-a21f-ee5d33859fab}","2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","bool":"System.Boolean","Guid":"System.Guid","int":"System.Int32","string":"System.String"}},"object":{"Graph":{"@Type":"f8a58466","@Value":{"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)\n(* OPTION 1\n// Double quote string\nq_sJsonString := '\"';\n\n// ... add JSON-escape ..//\nStrConcatA(pstFrom:= ADR(i_sRawString), pstTo:= ADR(q_sJsonString), iBufferSize:= UINT_TO_INT(GPL_Secop.Gc_uiMaxSizeMessage));\nStrConcatA(pstFrom:= ADR('\"'), pstTo:= ADR(q_sJsonString), iBufferSize:= UINT_TO_INT(GPL_Secop.Gc_uiMaxSizeMessage));\n*)\n\n(* OPTION 2 SE LIBRARY\n// Build {\"_\": \"<JSON-encoded>\"} with the JSON FB\nsJsonString := '';\nxJsonError S= NOT fbJson.New();\nxJsonError S= NOT fbJson.AddNameValuePair('_', i_sRawString); // Add pair \"_\" : <i_sStringValue>\n\n// Extract the produced JSON into sJsonString\nfbJson.Copy(i_anyBuffer := sJsonString);\n\n// Mark JSON error if the produced text is not valid JSON\nxJsonError := xJsonError OR NOT fbJson.IsJsonStringValid;\n\n// Unwrap: from {\"_\":\"<...>\"} take just the value literal \"<...>\"\ndiJsonStringLen := StrLenA(ADR(sJsonString));\nIF diJsonStringLen >= 7 THEN // minimal {\"_\":\"\"} length\n    iJsonStringStart := 6; // start right after '{\"_\":'  (5 chars)\n    iJsonStringCount := DINT_TO_INT(diJsonStringLen) - 5 - 1; // cut before trailing '}'  -> length = total - len(prefix) - 1\n    StrMidA(\n        pst                := ADR(sJsonString),\n        uiInputBufferSize  := SIZEOF(sJsonString),\n        iLength            := iJsonStringCount,\n        iPosition          := iJsonStringStart,\n        pstResult          := ADR(q_sJsonString),\n        uiResultBufferSize := SIZEOF(q_sJsonString)\n    );\nELSE\n    // Fallback: empty JSON string\n    q_sJsonString := '\"\"';\n    xJsonError := TRUE;\nEND_IF\n\n// Return TRUE on success\nM_JsonEncodeString := NOT xJsonError;\n*)\n\n(* OPTION 3 - CODESYS LIB USING UNICODE *)\n\nq_sJsonString := '';\nM_JsonEncodeString := FALSE;\n\n// Create JSON structure in memory: root will be a JSON string (not an array)\nIF pJsonData = 0 THEN\n\tpJsonData := factory.Create(eError => eErr);\nEND_IF\nIF (pJsonData = 0) OR (eErr <> FBF.ERROR.NO_ERROR) THEN\n    RETURN; // out of memory\nEND_IF;\n\n// Root = JSON string at index 0, parent = -1 (root)\nwsRaw := STRING_TO_WSTRING(i_sRawString);\npJsonData^.SetString(wsValue := wsRaw, diIndex := 0, diParentIndex := -1);\n\n// Serialize synchronously to WSTRING (no BUSY)\nwsJsonData := \"\"; // clear output buffer\nwriter(\n    xExecute    := TRUE,\n    xAsyncMode  := FALSE,             // synchronous: completes in this cycle\n    wsLinebreak := \"\",\n    pwData      := ADR(wsJsonData),\n    udiSize     := SIZEOF(wsJsonData),\n    jsonData    := pJsonData^\n);\n\n// Remove trailing \", \" added by JSON writer\ndiLenW := StrLenW(ADR(wsJsonData));  // length in wide characters\nIF diLenW > 2 THEN\n    wsJsonData[diLenW - 2] := 0;  // Terminator in UTF-16\n    q_sJsonString := WSTRING_TO_STRING(wsJsonData);\n    M_JsonEncodeString := TRUE;\nELSE\n    // Fallback: empty JSON string literal\n    q_sJsonString := '';\nEND_IF\n\n// reset FB\nwriter(xExecute := FALSE, jsonData := pJsonData^);\n \n","LineInfoPersistence":"(string)c6842e4b-ce22-4957-a5c5-84cdfb06c249_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)METHOD M_JsonEncodeString : BOOL\nVAR_INPUT\n\t/// Raw PLC string to be JSON-encoded\n\ti_sRawString: STRING(GPL.Gc_uiMaxSizeDescription);\nEND_VAR\nVAR_OUTPUT\n\t/// JSON-encoded string\n\tq_sJsonString: STRING(GPL.Gc_uiMaxSizeDescription);\nEND_VAR\nVAR\n(* OPTION 2\n\t/// JSON string unwrap helpers\n\tdiJsonStringLen: DINT;\n\tiJsonStringStart: INT;\n\tiJsonStringCount: INT;\n*)\n\nEND_VAR\n","LineInfoPersistence":"(string)c6842e4b-ce22-4957-a5c5-84cdfb06c249_Decl_LineIds"}}}}}},"TypeInfos":{"3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","f8a58466":"{f8a58466-d7f6-439f-bbb8-d4600e41d099}","string":"System.String"}}},"FormatVersion":"1.0"}