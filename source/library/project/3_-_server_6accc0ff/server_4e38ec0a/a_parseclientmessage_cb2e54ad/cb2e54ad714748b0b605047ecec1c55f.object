{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)cb2e54ad-7147-48b0-b605-047ecec1c55f","ParentGuid":"(Guid)4e38ec0a-c154-4a26-94f8-782bf3a9103c","Name":"(string)A_ParseClientMessage","Properties":{"@Type":"2c41fa04:IDictionary","@Value":{}},"TypeGuid":"(Guid)8ac092e5-3128-4e26-9e7e-11016c6684f2","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"8ac092e5","@Value":{"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)\n(* This action requires the following variables (declared in the Server POU) to be configured first\n\tsMessageToParse: STRING(GPL.Gc_uiMaxSizeMessage)\n*)\n\n// Initialise variables\nsAction := '';\nsSpecifier := '';\nsData := '';\nsModuleName := '';\nsAccessibleName := '';\niCountSubMessages := 0;\nStrCpyA(pBuffer := ADR(sTemp), pStr := ADR(sMessageToParse), iBufferSize := GPL.Gc_uiMaxSizeMessage);\niIndexSubMessage := 1;\n\n// Loop to find and extract submessages\nWHILE StrIsNullOrEmptyA(ADR(sTemp)) = FALSE AND (iIndexSubMessage < GCL.Gc_uiMaxNbOfSubmessages) DO\n\tetDelimiter := ET_Delimiter.Space;\n    iPos := StrFindA(pst1 := ADR(sTemp), pst2 := ADR(etDelimiter), uiSearchStart := 1);\n\n    // If delimiter is not found, break loop\n    IF iPos <= 0 THEN\n        EXIT;\n    END_IF;\n\t\n\tCASE iIndexSubMessage OF\n\t\t\n\t\t1: // Extract Action\n\t\t    StrMidA(pst := ADR(sTemp), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n        \t\t    iLength := iPos - 1, iPosition := 1,\n            \t\tpstResult := ADR(sAction), uiResultBufferSize :=GPL.Gc_uiMaxSizeMessage);\n\t\t\t\t\t\n\t\t2: // Extract Specifier\n   \t\t\tStrMidA(pst := ADR(sTemp), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n            \t\tiLength := iPos - 1, iPosition := 1,\n            \t\tpstResult := ADR(sSpecifier), uiResultBufferSize :=GPL.Gc_uiMaxSizeMessage);\n\tEND_CASE\n\n    // Remove extracted substring from temporary variable\n    StrMidA(pst := ADR(sTemp), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n            iLength := DINT_TO_INT(StrLenA(ADR(sTemp))) - iPos, iPosition := iPos + 1,\n            pstResult := ADR(sTemp), uiResultBufferSize := GPL.Gc_uiMaxSizeMessage);\n\n    iIndexSubMessage := iIndexSubMessage + 1;\nEND_WHILE;\n\n// After quitting the loop, process the last remaining substring\nIF StrIsNullOrEmptyA(ADR(sTemp)) = FALSE AND (iIndexSubMessage <= GCL.Gc_uiMaxNbOfSubmessages) THEN\n\n\t// Remove message terminator first\n\tetTerminator := ET_Terminator.CarriageReturn; // carriage return\n\tiPos := StrFindA(pst1 := ADR(sTemp), pst2 := ADR(etTerminator), uiSearchStart := 1);\n\tIF iPos >0 THEN\n    \tStrMidA(pst := ADR(sTemp), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n            iLength := iPos-1, iPosition := 1,\n            pstResult := ADR(sTemp), uiResultBufferSize := GPL.Gc_uiMaxSizeMessage);\n\tEND_IF\n\tetTerminator := ET_Terminator.LineFeed; // line feed\n\tiPos := StrFindA(pst1 := ADR(sTemp), pst2 := ADR(etTerminator), uiSearchStart := 1);\n\tIF iPos >0 THEN\n    \tStrMidA(pst := ADR(sTemp), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n            iLength := iPos-1, iPosition := 1,\n            pstResult := ADR(sTemp), uiResultBufferSize := GPL.Gc_uiMaxSizeMessage);\n\tEND_IF\n\t\n\tCASE iIndexSubMessage OF\n\t\t1: \t// Extract Action\n\t\t\tStrCpyA(pBuffer := ADR(sAction), pStr := ADR(sTemp), iBufferSize := GPL.Gc_uiMaxSizeMessage);\n\t\t\t\n\t\t2: \t// Extract Specifier\n\t\t\tStrCpyA(pBuffer := ADR(sSpecifier), pStr := ADR(sTemp), iBufferSize := GPL.Gc_uiMaxSizeMessage);\n\t\t\n\t\t3: \t// Extract Data\n\t\t\tStrCpyA(pBuffer := ADR(sData), pStr := ADR(sTemp), iBufferSize := GPL.Gc_uiMaxSizeMessage);\t\t\n\tEND_CASE\n \n    iCountSubMessages := iIndexSubMessage; // Include the last substring\nELSE\n    iCountSubMessages := iIndexSubMessage - 1; // Last index not used\nEND_IF;\n\n// Check if retrived Action is recognised in the protocol\nxActionIsImplemented := FALSE;\nFOR iIndexAction := 1 TO UINT_TO_INT(GPL.Gc_uiMaxNoOfActions) BY 1 DO\n\tIF sAction = GVL.G_st_SecNode.asAction[iIndexAction] THEN \n\t\txActionIsImplemented := TRUE; \n\t\tEXIT;\n\tEND_IF\nEND_FOR\n\n// If the message contains an implemented action and a specifier:\n// - retrieves module and accessible from specifier if it contains a colon delimiter\n// - otherwise, retrieves module name if the action is activate or deactivate for a specific module\n// - otherwise, the specifier will be used as an argument if the action is ping\n// - othwerise, raise format error\n\nxSpecifierFormatOk := TRUE;\nIF xActionIsImplemented AND StrIsNullOrEmptyA(ADR(sSpecifier)) = FALSE THEN\n\t\n\tetDelimiter := ET_Delimiter.Colon;\n    iPos := StrFindA(pst1 := ADR(sSpecifier), pst2 := ADR(etDelimiter), uiSearchStart := 1);\n\tIF iPos > 0 THEN \n\t\t\n\t\t// Extract Module\n\t\tStrMidA(pst := ADR(sSpecifier), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n        \t\t    iLength := iPos - 1, iPosition := 1,\n            \t\tpstResult := ADR(sModuleName), uiResultBufferSize :=GPL.Gc_uiMaxSizeMessage);\n\n\t\t// Extract Accessible\n    \tStrMidA(pst := ADR(sSpecifier), uiInputBufferSize := GPL.Gc_uiMaxSizeMessage,\n        \t    \tiLength := DINT_TO_INT(StrLenA(ADR(sSpecifier))) - iPos, iPosition := iPos + 1,\n            \t\tpstResult := ADR(sAccessibleName), uiResultBufferSize := GPL.Gc_uiMaxSizeMessage);\n\t\n\t// Specifier contains just a module name (without accessible) if the action is \"activate\" or \"deactivate\"\n\tELSIF iPos = 0 AND (sAction='activate' OR sAction='deactivate') THEN\n\t\tsModuleName:=sSpecifier;\n\t\t\n\tELSIF sAction<>'ping' THEN\n\t\t\n\t\txSpecifierFormatOk := FALSE; // Specifier format error\n    END_IF;\nEND_IF\n","LineInfoPersistence":"(string)cb2e54ad-7147-48b0-b605-047ecec1c55f_Impl_LineIds"}}}},"UniqueIdGenerator":"(string)127"}},"TypeInfos":{"3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","8ac092e5":"{8ac092e5-3128-4e26-9e7e-11016c6684f2}","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}